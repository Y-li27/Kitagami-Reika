function addStage(b,a){var c={};b.state.add("stage",{preload:function(){},create:function(){c.seClick=b.add.audio("se-click");c.bg=b.add.tileSprite(0,0,640,832,"stage-bg");c.home=b.add.button(20,10,"stage-home",function(g,h){c.disableBg=b.add.tileSprite(0,0,640,832,"disable-bg");c.disableBg.inputEnabled=true;c.disableBg.events.onInputDown.add(function(i,j){},this);c.dialogHalf=b.add.image(20,-135-416,"dialog-half");c.message=b.add.text(320,c.dialogHalf.y+90,"れいかのとある一日TOPへ\n戻りますか？",{font:"bold 32px Arial",fill:"#000000"});c.message.anchor.set(0.5);c.btnClose=b.add.button(550,c.dialogHalf.y-25,"btn-close",function(i,j){c.disableBg.destroy();c.homeDialogGroup.destroy()});c.btnPlay=b.add.button(200,c.dialogHalf.y+160,"stage-btn-back",function(i,j){location.href=ImasRunCommon.backUrl});c.homeDialogGroup=b.add.group();c.homeDialogGroup.add(c.dialogHalf);c.homeDialogGroup.add(c.message);c.homeDialogGroup.add(c.btnClose);c.homeDialogGroup.add(c.btnPlay);b.add.tween(c.homeDialogGroup).to({y:832},1000,Phaser.Easing.Bounce.Out,true,0)});c.stageTitle=b.add.image(320,50,"stage-title");c.stageTitle.anchor.set(0.5);if(a.sound==1&&bgmMenu==null){bgmMenu=b.add.audio("bgm-menu");bgmMenu.loopFull();bgmMenu.play()}c.sound=b.add.button(530,10,"sound",function(g,h){if(a.sound==1){a.sound=0;bgmMenu.pause();c.sound.setFrames(0,0,0)}else{a.sound=1;if(bgmMenu==null){bgmMenu=b.add.audio("bgm-menu");bgmMenu.loopFull();bgmMenu.play()}else{bgmMenu.resume()}c.sound.setFrames(1,1,1)}saveGameData(a)},this,a.sound,a.sound,a.sound);c.coinBg=b.add.image(20,96,"coin-bg");c.coin=parseInt(a.coin);c.coinText=b.add.text(100,114,c.coin+"枚",{font:"bold 42px Arial",fill:"#000"});c.stageShop=b.add.button(420,96,"stage-shop",function(g,h){if(a.sound==1){c.seClick.play()}b.state.start("shop")});c.lineH1=b.add.image(70,230,"stage-line-h");c.lineH2=b.add.image(70,390,"stage-line-h");c.lineH3=b.add.image(70,550,"stage-line-h");c.lineH1=b.add.image(490,320,"stage-line-v");c.lineH2=b.add.image(90,480,"stage-line-v");c.lineH3=b.add.image(490,640,"stage-line-v");c.stageBtn=[];c.stageStar=[];c.dialogStar=[];c.dialogStarTotal=0;c.dialogItem=[];c.diaryNew=0;c.diaryNewView=null;for(var e=1;e<=12;e++){if(Math.ceil(e/3)%2==1){x=20+(((e-1)%3)*200)}else{x=420-(((e-1)%3)*200)}y=180+Math.floor((e-1)/3)*160;if(e==11){if(c.dialogStarTotal<50){c.stageBtn[e]=b.add.image(x,y,"stage-clear-disable")}else{c.stageBtn[e]=b.add.button(x,y,"stage-clear",function(g,h){c.disableBg=b.add.tileSprite(0,0,640,832,"disable-bg");c.disableBg.inputEnabled=true;c.disableBg.events.onInputDown.add(function(i,j){},this);c.dialogHalf=b.add.image(20,-135-416,"dialog-half");c.message=b.add.text(320,c.dialogHalf.y+90,"エンディングストーリーをみますか？",{font:"bold 32px Arial",fill:"#000000"});c.message.anchor.set(0.5);c.btnClose=b.add.button(550,c.dialogHalf.y-25,"btn-close",function(i,j){c.disableBg.destroy();c.homeDialogGroup.destroy()});c.btnPlay=b.add.button(320,c.dialogHalf.y+180,"diary-btn-view",function(i,j){location.href=ImasRunCommon.clearUrl},1,1,1);c.btnPlay.anchor.set(0.5);c.homeDialogGroup=b.add.group();c.homeDialogGroup.add(c.dialogHalf);c.homeDialogGroup.add(c.message);c.homeDialogGroup.add(c.btnClose);c.homeDialogGroup.add(c.btnPlay);b.add.tween(c.homeDialogGroup).to({y:832},1000,Phaser.Easing.Bounce.Out,true,0);a.clearView=1;saveGameData(a);c.clearNewView.destroy()});if(a.clearView==0){c.clearNewView=b.add.image(x+160,y+15,"new-icon");c.clearNewView.anchor.set(0.5);b.add.tween(c.clearNewView.scale).to({x:1.2,y:1.2},1000,Phaser.Easing.Linear.None,true,0,-1,true)}}}else{if(e==12){c.stageBtn[e]=b.add.button(x,y,"stage-diary",function(g,h){if(a.sound==1){c.seClick.play()}b.state.start("diary")});if(c.diaryNew==1||(c.dialogStarTotal==50&&a.diary[11][1]==0)){c.diaryNewView=b.add.image(x+160,y+15,"new-icon");c.diaryNewView.anchor.set(0.5);b.add.tween(c.diaryNewView.scale).to({x:1.2,y:1.2},1000,Phaser.Easing.Linear.None,true,0,-1,true)}}else{if(e<=parseInt(a.clear)+1){c.stageBtn[e]=b.add.button(x,y,"stage-stage"+e,function(j,n){if(a.sound==1){c.seClick.play()}stageNo=j.key.replace("stage-stage","");c.disableBg=b.add.tileSprite(0,0,640,832,"disable-bg");c.disableBg.inputEnabled=true;c.disableBg.events.onInputDown.add(function(k,o){},this);c.dialog=b.add.image(20,150,"dialog");stageSubNo=1;c.dialogStarNow=false;var m=0;for(var i=1;i<=5;i++){if(a.stage[stageNo][i]==1){m=((stageNo-1)*5)+i-1;c.dialogStar[i]=b.add.image(160+((i-1)*80),c.dialog.y+140,"tiles-sheet",m);stageSubNo++}else{if(c.dialogStarNow==false){m=((stageNo-1)*5)+i-1;c.dialogStarNow=true;c.dialogStar[i]=b.add.image(160+((i-1)*80),c.dialog.y+140,"tiles-sheet",m);c.dialogStar[i].scale.x=1.1;c.dialogStar[i].scale.y=1.1;b.add.tween(c.dialogStar[i].scale).to({x:1.3,y:1.3},1000,Phaser.Easing.Linear.None,true,0,-1,true)}else{c.dialogStar[i]=b.add.image(160+((i-1)*80),c.dialog.y+140,"star",0)}}c.dialogStar[i].anchor.set(0.5)}var l="ステージ"+stageNo;if(stageSubNo<=5){l+=" - "+stageSubNo}c.text=b.add.text(320,c.dialog.y+66,l,{font:"bold 58px Arial",fill:"#000"});c.text.anchor.set(0.5);var h="エンドレス";if(stageSubNo<=5){h=ImasRunCommon.StageIdolList[stageNo][stageSubNo][1]+"に会いにいこう"}c.description=b.add.text(320,c.dialog.y+210,h,{font:"bold 32px Arial",fill:"#000000"});c.description.anchor.set(0.5);c.dialogItemSet=null;c.dialogRecomend=null;c.dialogItem[0]=b.add.button(180,c.dialog.y+280,"stage-item0",function(k,o){if(a.setItem!=0){if(a.sound==1){c.seClick.play()}c.dialogItem[a.setItem].setFrames(1,1,1)}a.setItem=0;saveGameData(a)},this);c.dialogItem[0].anchor.set(0.5);for(var i in ImasRunCommon.ItemList){if(c.dialogStarTotal<50&&i==7){continue}if(i<=3){x=180+(i*90);y=c.dialog.y+280}else{x=180+((i-4)*90);y=c.dialog.y+378}var g=1;if(a.setItem==i){g=2}if(a["item"+i]==1){c.dialogItem[i]=b.add.button(x,y,"stage-item"+i,function(o,p){var k=o.key.replace("stage-item","");if(a.setItem==k){return}c.dialogItem[k].setFrames(2,2,2);if(a.sound==1&&a.setItem!=k){c.seClick.play()}if(a.setItem!=0){c.dialogItem[a.setItem].setFrames(1,1,1)}a.setItem=k;saveGameData(a)},this,g,g,g)}else{c.dialogItem[i]=b.add.image(x,y,"stage-item"+i)}c.dialogItem[i].anchor.set(0.5);if(stageSubNo<=5){if(ImasRunCommon.StageIdolList[stageNo][stageSubNo][6]==i){c.dialogRecomend=b.add.image(x,y-40,"stage-recommend");c.dialogRecomend.anchor.set(0.5);b.add.tween(c.dialogRecomend.scale).to({x:1.2,y:1.2},1000,Phaser.Easing.Linear.None,true,0,-1,true)}}}c.btnClose=b.add.button(550,c.dialog.y-25,"btn-close",function(k,o){if(a.sound==1){c.seClick.play()}c.disableBg.destroy();c.dialog.destroy();c.text.destroy();c.description.destroy();for(i=1;i<=c.dialogStar.length-1;i++){c.dialogStar[i].destroy()}c.dialogStar[1].destroy();for(i=0;i<=c.dialogItem.length-1;i++){c.dialogItem[i].destroy()}if(c.dialogItemSet){c.dialogItemSet.destroy()}if(c.dialogRecomend){c.dialogRecomend.destroy()}c.btnClose.destroy();c.btnPlay.destroy()},this);c.btnPlay=b.add.button(200,c.dialog.y+430,"stage-btn-play",function(k,o){if(a.sound==1){c.seClick.play()}if(bgmMenu!=null){bgmMenu.destroy();bgmMenu=null}b.state.start("play")},this)},this,1,1,1)}else{c.stageBtn[e]=b.add.image(x,y,"stage-stage"+e,0)}for(var d=1;d<=5;d++){c.stageStar[e]=[];xDiff=(d-1)*30;if(a.stage[e][d]==1){var f=((e-1)*5)+d-1;c.stageStar[e][d]=b.add.image(x+25+xDiff,y+116,"tiles-sheet",f);c.dialogStarTotal++;if(a.diary[e][d]==0){c.diaryNew=1}}else{c.stageStar[e][d]=b.add.image(x+25+xDiff,y+116,"star")}c.stageStar[e][d].scale.set(0.5)}}}}if(c.dialogStarTotal==50&&a.item7View==0){c.shopNewView=b.add.image(590,101,"new-icon");c.shopNewView.anchor.set(0.5);b.add.tween(c.shopNewView.scale).to({x:1.2,y:1.2},1000,Phaser.Easing.Linear.None,true,0,-1,true)}},update:function(){}})};