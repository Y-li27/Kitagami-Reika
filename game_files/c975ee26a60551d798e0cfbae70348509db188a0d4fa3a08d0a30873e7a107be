function addPlay(t,h){const s=0;const d=1;const j=2;const u=9;var b={};t.state.add("play",{preload:function(){},create:function(){b.seClick=t.add.audio("se-click");b.seCoinS=t.add.audio("se-coin-s");b.seCoinM=t.add.audio("se-coin-m");b.seCoinL=t.add.audio("se-coin-l");b.seCollideEnemy=t.add.audio("se-collide-enemy");b.seCount=t.add.audio("se-count");b.seCountGo=t.add.audio("se-count-go");b.seDownEnemy=t.add.audio("se-down-enemy");b.seDownEnemyAkane=t.add.audio("se-down-enemy-akane");b.seDownEnemyAkaneMuteki=t.add.audio("se-down-enemy-akane-muteki");b.seDownEnemyMuteki=t.add.audio("se-down-enemy-muteki");b.seGameOver=t.add.audio("se-game-over");b.seGameClear=t.add.audio("se-game-clear");b.seGameClearStar=t.add.audio("se-game-clear-star");b.seJump=t.add.audio("se-jump");b.seJumpBig=t.add.audio("se-jump-big");b.seStar=t.add.audio("se-star");b.seWarp=t.add.audio("se-warp");t.physics.startSystem(Phaser.Physics.ARCADE);b.stageSubNo=1;$.each(h.stage[stageNo],function(v){if(h.stage[stageNo][v]==1){b.stageSubNo++}});n();c();k();f();l();o();q();g();p();a();e();t.camera.follow(b.playIdol,Phaser.Camera.FOLLOW_LOCKON,1,1);t.camera.deadzone=new Phaser.Rectangle(20,0,20,832);b.playStatus=s},render:function(){},update:function(){if(b.playStatus==j){if(stageNo==7){b.playBg.x=t.camera.x-640;b.playScene.x=t.camera.x-640;b.playBg.tilePosition.x-=(b.playIdol.x-b.fromWarpX)*0.2;b.playScene.tilePosition.x-=(b.playIdol.x-b.fromWarpX)*0.5;b.fromWarpX=b.playIdol.x}else{b.playBg.x=t.camera.x;b.playScene.x=t.camera.x;b.playBg.tilePosition.x-=(b.playIdol.x-b.fromWarpX)*0.2;b.playScene.tilePosition.x-=(b.playIdol.x-b.fromWarpX)*0.5;b.fromWarpX=b.playIdol.x}b.pause.x=t.camera.x+20;b.coinText.x=t.camera.x+320;b.sound.x=t.camera.x+530;if(b.stageSubNo<=5){b.star.x=t.camera.x+114}if(0<b.enemy.length){t.physics.arcade.collide(b.enemyGroup,b.layer)}}else{if(stageNo==5||stageNo==6){b.playBg.tilePosition.x-=0.5}else{b.playBg.tilePosition.x-=0.25}b.playBg.x=t.camera.x;b.playScene.x=t.camera.x;if(b.emitter){b.emitter.x=t.camera.x+320}if(stageNo==3||stageNo==4){b.playElement.x+=8;if(t.world.width<b.playElement.x){b.playElement.x=-1000}}else{if(stageNo==9||stageNo==10){if(b.playStatus==s){b.playElementHallX-=0.5;b.playElementHall.x=b.playIdol.x+b.playElementHallX;if(b.playElementHall.x<b.playIdol.x-1000){b.playElementHallX=1500}}b.playElementHall.angle+=0.2;if(360<b.playElementHall.angle){b.playElementHall.angle=0}b.playElementRocket.x+=8;b.playElementRocket.y-=1.5;if(b.playElementRocket.y<-1000){b.playElementRocket.x=t.camera.x-1240;b.playElementRocket.y=900}b.playElementUfo.x+=8;b.playElementUfo.y+=1;if(1000<b.playElementUfo.y){b.playElementUfo.x=t.camera.x-1240;b.playElementUfo.y=-100}}}if(h.setItem==ImasRunCommon.Iteminvincible){b.playIdolInvincible.x=b.playIdol.x+(b.playIdol.width*3/5);b.playIdolInvincible.y=b.playIdol.y+(b.playIdol.height/2)}t.physics.arcade.collide(b.playIdol,b.layer);if(0<b.enemy.length){t.physics.arcade.collide(b.enemyGroup,b.layer);t.physics.arcade.collide(b.playIdol,b.enemyGroup,function(w,v){if(v.body.touching.up){if(v.key.substr(v.key.length-5,5)!="-down"){if(h.sound==1){if(v.key.indexOf("big1")!=-1){b.seDownEnemyAkane.play()}else{b.seDownEnemy.play()}}v.loadTexture(v.key+"-down",0);if(h.setItem==ImasRunCommon.ItemJumpUp){b.playIdol.body.velocity.y=-800}else{if(h.setItem==ImasRunCommon.ItemSpeedUp){b.playIdol.body.velocity.y=-690}else{b.playIdol.body.velocity.y=-600}}b.jump=2;v.body=null;v.outOfCameraBoundsKill=true;v.anchor.set(0.5);v.x=v.x+(v.width/2);v.y=v.y+(v.height/2);t.tweens.removeFrom(v);t.add.tween(v).to({x:v.x+300,y:1000,angle:720},3000,Phaser.Easing.Cubic.Out,true)}}else{if(h.setItem==ImasRunCommon.Iteminvincible){if(h.sound==1){if(v.key.indexOf("big1")!=-1){b.seDownEnemyAkaneMuteki.play()}else{b.seDownEnemyMuteki.play()}}if(v.key.substr(v.key.length-5,5)!="-down"){v.loadTexture(v.key+"-down",0)}v.body=null;v.outOfCameraBoundsKill=true;t.add.tween(v).to({x:v.x+1000,y:-500,angle:-720},2000,Phaser.Easing.Cubic.Out,true)}else{if(b.playStatus!=d){if(h.sound==1){b.seCollideEnemy.play()}m()}}}})}if(b.playStatus==s){if(!b.playIdol.body.blocked.right&&b.playIdol.worldPosition.x<=50){if(h.setItem==ImasRunCommon.ItemSpeedUp){b.playScene.tilePosition.x-=6}else{b.playScene.tilePosition.x-=3}}b.playIdol.body.velocity.x=300;if(h.setItem==ImasRunCommon.ItemSpeedUp){b.playIdol.body.velocity.x*=2}for(i=0;i<b.enemy.length;i++){if(b.enemy[i].body&&b.enemyVelocity[i]!=0){if(b.enemy[i].body.blocked.right||b.enemy[i].body.blocked.left){b.enemyVelocity[i]*=-1}b.enemy[i].body.velocity.x=b.enemyVelocity[i]}}if(b.count3){b.count3.x=t.camera.x+320}if(b.count2){b.count2.x=t.camera.x+320}if(b.count1){b.count1.x=t.camera.x+320}if(b.countGo){b.countGo.x=t.camera.x+320}if(b.fog){b.fog.x=t.camera.x+168}b.pause.x=t.camera.x+20;b.coinText.x=t.camera.x+320;b.sound.x=t.camera.x+530;if(b.stageSubNo<=5){b.star.x=t.camera.x+114}if(b.jump==1){if(h.setItem==ImasRunCommon.ItemJumpUp){b.playIdol.body.velocity.y=-800}else{if(h.setItem==ImasRunCommon.ItemSpeedUp){b.playIdol.body.velocity.y=-690}else{b.playIdol.body.velocity.y=-600}}b.jump=2}else{if(b.jump==2){if(b.playIdol.body.blocked.down){b.jump=0;b.playIdol.loadTexture("play-idol-run",0);b.playIdol.animations.play("run",6,true);if(h.setItem==ImasRunCommon.ItemSpeedUp){b.playIdol.animations.currentAnim.speed=16}else{b.playIdol.animations.currentAnim.speed=8}}}else{if(b.jump==3){b.playIdol.body.velocity.y=-600;b.jump=4}else{if(b.jump==4){if(b.playIdol.body.blocked.down||b.playIdol.body.touching.down){b.jump=0;b.playIdol.loadTexture("play-idol-run",0);b.playIdol.animations.play("run",6,true);if(h.setItem==ImasRunCommon.ItemSpeedUp){b.playIdol.animations.currentAnim.speed=16}else{b.playIdol.animations.currentAnim.speed=8}}}}}}if(640<b.playIdol.worldPosition.x){r()}else{if(735<b.playIdol.y&&b.playIdol.worldPosition.x<640-86){if(h.sound==1){b.seCollideEnemy.play()}m()}}}}}});function n(){if(stageNo==3||stageNo==4){b.playBg=t.add.tileSprite(0,0,1920,832,"play-bg2")}else{if(stageNo==5||stageNo==6){b.playBg=t.add.tileSprite(0,0,1920,832,"play-bg3")}else{if(stageNo==7||stageNo==8){b.playBg=t.add.tileSprite(0,0,1920,832,"play-bg4")}else{if(stageNo==9||stageNo==10){b.playBg=t.add.tileSprite(0,0,1920,832,"play-bg5")}else{b.playBg=t.add.tileSprite(0,0,1920,832,"play-bg1")}}}}}function c(){if(stageNo==3||stageNo==4){b.playScene=t.add.tileSprite(0,0,1920,832,"play-scene2")}else{if(stageNo==5||stageNo==6){b.playScene=t.add.tileSprite(0,0,1920,832,"play-scene3")}else{if(stageNo==7||stageNo==8){b.playScene=t.add.tileSprite(0,0,1920,832,"play-scene4")}else{if(stageNo==9||stageNo==10){b.playElementHallX=1500;b.playElementHall=t.add.sprite(b.playElementHallX,416,"play-element-hall");b.playElementHall.anchor.set(0.5);b.playScene=t.add.tileSprite(0,0,1920,832,"play-scene5")}else{b.playScene=t.add.tileSprite(0,0,1920,832,"play-scene1")}}}}}function k(){if(stageNo==3||stageNo==4){b.playElement=t.add.sprite(-1000,710,"play-element-train")}else{if(stageNo==9||stageNo==10){b.playElementRocket=t.add.sprite(-1240,900,"play-element-rocket");b.playElementRocket.anchor.set(0.5);b.playElementRocket.angle=155;b.playElementUfo=t.add.sprite(-2500,-300,"play-element-ufo")}}}function l(){b.map=t.add.tilemap("stage"+stageNo+"-"+b.stageSubNo);b.map.addTilesetImage("tiles");b.layer=b.map.createLayer("stage_"+stageNo+"-"+b.stageSubNo);b.layer.resizeWorld();b.map.setCollisionBetween(1,90);b.map.setTileIndexCallback([61,62,63,64,65,66,67,68,69,70,81,82,83,84],function(v,w){if(v.key.indexOf("play-idol")!=-1){if(w.worldX<v.x+v.width-22&&w.worldY<v.y+v.height-6&&v.y+v.height-6<w.worldY+w.height){b.playIdol.y=w.worldY-v.height;b.playIdol.body.velocity.y=0;b.jump=0;b.playIdol.loadTexture("play-idol-run",0);b.playIdol.animations.play("run",6,true);if(h.setItem==ImasRunCommon.ItemSpeedUp){b.playIdol.animations.currentAnim.speed=16}else{b.playIdol.animations.currentAnim.speed=8}}}return true},this);b.map.setTileIndexCallback(51,function(v,w){if(0<w.alpha&&v.key.indexOf("play-idol")!=-1){if(h.setItem==ImasRunCommon.ItemCoinUp){b.coin+=2}else{b.coin+=1}if(ImasRunCommon.MaxCoin<b.coin){b.coin=ImasRunCommon.MaxCoin}b.coinText.text=b.coin+"枚";w.alpha=0;if(h.sound==1){b.seCoinS.play()}}return false},this);b.map.setTileIndexCallback(52,function(v,w){if(0<w.alpha&&v.key.indexOf("play-idol")!=-1){if(h.setItem==ImasRunCommon.ItemCoinUp){b.coin+=20}else{b.coin+=10}if(ImasRunCommon.MaxCoin<b.coin){b.coin=ImasRunCommon.MaxCoin}b.coinText.text=b.coin+"枚";w.alpha=0;if(h.sound==1){b.seCoinM.play()}}return false},this);b.map.setTileIndexCallback(53,function(v,w){if(0<w.alpha&&v.key.indexOf("play-idol")!=-1){if(h.setItem==ImasRunCommon.ItemCoinUp){b.coin+=200}else{b.coin+=100}if(ImasRunCommon.MaxCoin<b.coin){b.coin=ImasRunCommon.MaxCoin}b.coinText.text=b.coin+"枚";w.alpha=0;if(h.sound==1){b.seCoinL.play()}}return false},this);b.map.setTileIndexCallback(60,function(v,w){if(v.key.indexOf("play-enemy")!=-1){return true}if(h.sound==1){b.seWarp.play()}b.fromWarpX=b.playIdol.x;if(stageNo==5&&b.stageSubNo==3){b.playStatus=j;if(b.playIdol.x<160*52){b.warpTween=t.add.tween(b.playIdol).to({x:144*52,y:30},2000,Phaser.Easing.Cubic.Out,true)}else{b.warpTween=t.add.tween(b.playIdol).to({x:181*52,y:20},2000,Phaser.Easing.Cubic.Out,true)}b.warpTween.onComplete.add(function(){b.playStatus=s},this)}else{if(stageNo==7){b.playStatus=j;b.playBg.tilePosition.x+=640;b.playScene.tilePosition.x+=640;if(b.stageSubNo==1){if(b.playIdol.x<120*52){b.warpTween=t.add.tween(b.playIdol).to({x:80,y:320},2000,Phaser.Easing.Cubic.Out,true)}else{if(b.playIdol.x<170*52){b.warpTween=t.add.tween(b.playIdol).to({x:63*52,y:6*52},2000,Phaser.Easing.Cubic.Out,true)}else{if(b.playIdol.x<240*52){b.warpTween=t.add.tween(b.playIdol).to({x:140*52,y:4*52},2000,Phaser.Easing.Cubic.Out,true)}else{b.warpTween=t.add.tween(b.playIdol).to({x:227*52,y:11*52},2000,Phaser.Easing.Cubic.Out,true)}}}}else{if(b.stageSubNo==2){if(b.playIdol.x<120*52){b.warpTween=t.add.tween(b.playIdol).to({x:80,y:320},2000,Phaser.Easing.Cubic.Out,true)}else{if(b.playIdol.x<160*52){b.warpTween=t.add.tween(b.playIdol).to({x:85*52,y:4*52},2000,Phaser.Easing.Cubic.Out,true)}else{b.warpTween=t.add.tween(b.playIdol).to({x:143*52,y:4*52},2000,Phaser.Easing.Cubic.Out,true)}}}else{if(b.stageSubNo==3){if(b.playIdol.x<120*52){b.warpTween=t.add.tween(b.playIdol).to({x:80,y:320},2000,Phaser.Easing.Cubic.Out,true)}else{if(b.playIdol.x<170*52){b.warpTween=t.add.tween(b.playIdol).to({x:70*52,y:11*52},2000,Phaser.Easing.Cubic.Out,true)}else{if(b.playIdol.x<220*52){b.warpTween=t.add.tween(b.playIdol).to({x:148*52,y:11*52},2000,Phaser.Easing.Cubic.Out,true)}else{if(b.playIdol.x<264*52){b.warpTween=t.add.tween(b.playIdol).to({x:228*52,y:11*52},2000,Phaser.Easing.Cubic.Out,true)}else{b.warpTween=t.add.tween(b.playIdol).to({x:254*52,y:4*52},2000,Phaser.Easing.Cubic.Out,true)}}}}}else{if(b.stageSubNo==4){if(b.playIdol.x<120*52){b.warpTween=t.add.tween(b.playIdol).to({x:80,y:320},2000,Phaser.Easing.Cubic.Out,true)}else{if(b.playIdol.x<180*52){b.warpTween=t.add.tween(b.playIdol).to({x:75*52,y:6*52},2000,Phaser.Easing.Cubic.Out,true)}else{if(b.playIdol.x<250*52){b.warpTween=t.add.tween(b.playIdol).to({x:179*52,y:6*52},2000,Phaser.Easing.Cubic.Out,true)}else{b.warpTween=t.add.tween(b.playIdol).to({x:254*52,y:11*52},2000,Phaser.Easing.Cubic.Out,true)}}}}else{if(b.playIdol.x<120*52){b.warpTween=t.add.tween(b.playIdol).to({x:80,y:320},2000,Phaser.Easing.Cubic.Out,true)}else{if(b.playIdol.x<180*52){b.warpTween=t.add.tween(b.playIdol).to({x:70*52,y:11*52},2000,Phaser.Easing.Cubic.Out,true)}else{b.warpTween=t.add.tween(b.playIdol).to({x:146*52,y:11*52},2000,Phaser.Easing.Cubic.Out,true)}}}}}}b.warpTween.onComplete.add(function(){b.playBg.x=t.camera.x;b.playScene.x=t.camera.x;b.playBg.tilePosition.x-=200;b.playScene.tilePosition.x-=200;b.playStatus=s},this)}else{if(stageNo==10){b.playStatus=j;b.warpTween=t.add.tween(b.playIdol).to({x:257*52,y:-52},2000,Phaser.Easing.Cubic.Out,true);b.warpTween.onComplete.add(function(){b.playStatus=s},this)}}}return false},this);if(b.stageSubNo<=5){b.map.setTileIndexCallback(((stageNo-1)*5)+b.stageSubNo,function(v,w){if(0<w.alpha&&v.key.indexOf("play-idol")!=-1){if(h.sound==1){b.seStar.play()}w.alpha=0;var x=((stageNo-1)*5)+b.stageSubNo-1;b.star.loadTexture("tiles-sheet",x);b.starStatus=1}return false},this);b.starStatus=0}else{b.starStatus=1}}function o(){var v=400;if(stageNo==3){v=100}else{if(stageNo==5){if(b.stageSubNo==4){v=50}else{v=600}}else{if(stageNo==1||stageNo==2||stageNo==4||stageNo==9){v=600}else{if(stageNo==7){if(b.stageSubNo==1){v=600}else{v=350}}else{if(stageNo==8||stageNo==10){v=200}}}}}b.playIdolInvincible=null;if(h.setItem==ImasRunCommon.Iteminvincible){b.playIdolInvincible=t.add.sprite(0,0,"play-idol-invincible");b.playIdolInvincible.anchor.set(0.5);t.add.tween(b.playIdolInvincible).to({angle:-360},5000,Phaser.Easing.Linear.None,true,0,-1)}b.playIdol=t.add.sprite(20,v,"play-idol-run");b.playIdol.animations.add("run");b.playIdol.animations.play("run",6,true);if(h.setItem==ImasRunCommon.ItemSpeedUp){b.playIdol.animations.currentAnim.speed=16}else{b.playIdol.animations.currentAnim.speed=8}t.physics.arcade.enable(b.playIdol);b.playIdol.body.fixedRotation=true;b.playIdol.body.gravity.x=0;b.playIdol.body.gravity.y=1000;b.playIdol.body.maxVelocity.y=1000;b.playIdol.body.setSize(64,132,50,30);b.playIdol.checkWorldBounds=true}function q(){b.jump=0;t.input.onDown.add(function(v){if(100<v.y){if(t.paused){if(b.pauseBtnClose.getBounds().contains(t.input.x,t.input.y)){if(h.sound==1){b.seClick.play()}t.paused=false;b.disableBg.destroy();b.pauseDialog.destroy()}else{if(b.pauseBtnRedo.getBounds().contains(t.input.x,t.input.y)){if(h.sound==1){b.seClick.play()}t.paused=false;if(b.bgm!=null){b.bgm.destroy()}t.state.restart("play")}else{if(b.pauseBtnBack.getBounds().contains(t.input.x,t.input.y)){if(h.sound==1){b.seClick.play()}t.paused=false;if(b.bgm!=null){b.bgm.destroy()}t.state.start("stage")}}}}else{if(b.playStatus==s){if(b.jump==0&&(b.playIdol.body.velocity.y<=0||b.playIdol.body.touching.down)){if(h.sound==1){if(h.setItem==ImasRunCommon.ItemJumpUp){b.seJumpBig.play()}else{b.seJump.play()}}b.jump=1;b.playIdol.loadTexture("play-idol-jump",0);b.playIdol.animations.play("run",6,true);if(h.setItem==ImasRunCommon.ItemSpeedUp){b.playIdol.animations.currentAnim.speed=16}else{b.playIdol.animations.currentAnim.speed=8}}else{if(h.setItem==ImasRunCommon.ItemFly){if(h.sound==1){b.seJump.play()}b.jump=1;b.playIdol.loadTexture("play-idol-jump",0);b.playIdol.animations.play("run",6,true);if(h.setItem==ImasRunCommon.ItemSpeedUp){b.playIdol.animations.currentAnim.speed=16}else{b.playIdol.animations.currentAnim.speed=8}}else{if(b.jump==2&&h.setItem==ImasRunCommon.Item2Jump){if(h.sound==1){b.seJump.play()}b.jump=3}}}}}}},t);t.input.onUp.add(function(v,w){if((b.jump==2||b.jump==4)&&b.playIdol.body.velocity.y<=0){b.playIdol.body.velocity.y=b.playIdol.body.velocity.y/2}},t)}function g(){b.enemy=[];b.enemyVelocity=[];var v=0;if(stageNo in ImasRunCommon.EnemyList&&b.stageSubNo in ImasRunCommon.EnemyList[stageNo]){for(v=0;v<ImasRunCommon.EnemyList[stageNo][b.stageSubNo].length;v++){b.enemy[v]=t.add.sprite(ImasRunCommon.EnemyList[stageNo][b.stageSubNo][v][0],ImasRunCommon.EnemyList[stageNo][b.stageSubNo][v][1],"play-enemy-"+ImasRunCommon.EnemyList[stageNo][b.stageSubNo][v][2]);b.enemy[v].animations.add("walk");b.enemy[v].animations.play("walk",3,true);t.physics.arcade.enable(b.enemy[v]);b.enemy[v].body.gravity.x=0;if(ImasRunCommon.EnemyList[stageNo][b.stageSubNo][v][2]=="big1"){b.enemy[v].body.gravity.y=1000;b.enemy[v].body.setSize(100,140,50,60)}else{if(ImasRunCommon.EnemyList[stageNo][b.stageSubNo][v][2]=="fly1"){b.enemy[v].body.gravity.y=0;b.enemy[v].body.setSize(60,60,30,20)}else{b.enemy[v].body.gravity.y=1000;b.enemy[v].body.setSize(50,80,40,40)}}b.enemy[v].checkWorldBounds=true;b.enemyVelocity[v]=ImasRunCommon.EnemyList[stageNo][b.stageSubNo][v][3];if(ImasRunCommon.EnemyList[stageNo][b.stageSubNo][v][3]==0){t.add.tween(b.enemy[v]).to({x:ImasRunCommon.EnemyList[stageNo][b.stageSubNo][v][4],y:ImasRunCommon.EnemyList[stageNo][b.stageSubNo][v][5]},ImasRunCommon.EnemyList[stageNo][b.stageSubNo][v][6],Phaser.Easing.Linear.None,true,0,-1,true)}}}b.enemyGroup=t.add.group();for(v=0;v<b.enemy.length;v++){b.enemyGroup.add(b.enemy[v])}}function p(){b.fog=null;if(stageNo==2){b.fog=t.add.image(168,0,"play-weather-fog");if(h.setItem==ImasRunCommon.ItemWeather){b.fog.alpha=0.9;t.add.tween(b.fog).to({alpha:0},3000,Phaser.Easing.Linear.None,true,1000)}}}function f(){b.emitter=null;if(stageNo==4){b.emitter=t.add.emitter(0,0,10);b.emitter.width=1280;b.emitter.makeParticles("play-weather-rain");b.emitter.minParticleScale=0.5;b.emitter.maxParticleScale=1;b.emitter.setYSpeed(100,200);b.emitter.setXSpeed(-5,5);b.emitter.minRotation=-150;b.emitter.maxRotation=150;b.emitter.gravity=250;b.emitter.flow(2000,500,5,-1)}}function a(){var v=0;var w=1000;var x=500;if(h.setItem==ImasRunCommon.ItemSpeedUp){v=0;w=500;x=250}b.count3=t.add.image(0,-2000,"play-countdown",0);b.count3.anchor.set(0.5);b.count3TweenDown=t.add.tween(b.count3).to({y:t.world.centerY},w,Phaser.Easing.Cubic.Out,true,v);b.count3TweenDown.onComplete.add(function(){if(h.sound==1){b.seCount.play()}},this);v+=w;b.count3Tween=t.add.tween(b.count3).to({alpha:0},x,Phaser.Easing.Linear.None,true,v);b.count3Tween.onComplete.add(function(){b.count3.destroy();b.count3=null},this);b.count2=t.add.image(0,-2000,"play-countdown",1);b.count2.anchor.set(0.5);b.count2TweenDown=t.add.tween(b.count2).to({y:t.world.centerY},w,Phaser.Easing.Cubic.Out,true,v);b.count2TweenDown.onComplete.add(function(){if(h.sound==1){b.seCount.play()}},this);v+=w;b.count2Tween=t.add.tween(b.count2).to({alpha:0},x,Phaser.Easing.Linear.None,true,v);b.count2Tween.onComplete.add(function(){b.count2.destroy();b.count2=null},this);b.count1=t.add.image(0,-2000,"play-countdown",2);b.count1.anchor.set(0.5);b.count1TweenDown=t.add.tween(b.count1).to({y:t.world.centerY},w,Phaser.Easing.Cubic.Out,true,v);b.count1TweenDown.onComplete.add(function(){if(h.sound==1){b.seCount.play()}},this);v+=w;b.count1Tween=t.add.tween(b.count1).to({alpha:0},x,Phaser.Easing.Linear.None,true,v);b.count1Tween.onComplete.add(function(){b.count1.destroy();b.count1=null},this);b.countGo=t.add.image(0,-2000,"play-countdown",3);b.countGo.anchor.set(0.5);b.countGoTweenDown=t.add.tween(b.countGo).to({y:t.world.centerY},w,Phaser.Easing.Cubic.Out,true,v);b.countGoTweenDown.onComplete.add(function(){if(h.sound==1){b.seCountGo.play()}},this);v+=w;b.countGoTween=t.add.tween(b.countGo).to({alpha:0},x,Phaser.Easing.Linear.None,true,v);b.countGoTween.onComplete.add(function(){b.countGo.destroy();b.countGo=null},this)}function e(){b.coin=0;b.coinText=t.add.text(320,50,"0枚",{font:"32px Arial",fill:"#fff",stroke:"#000",strokeThickness:10});b.coinText.anchor.set(0.5);if(b.stageSubNo<=5){b.star=t.add.image(114,24,"star")}b.bgm=null;if(h.sound==1){b.bgm=t.add.audio("bgm-theme"+Math.ceil(stageNo/2));b.bgm.loopFull();b.bgm.play()}b.sound=t.add.button(530,10,"sound",function(v,w){if(h.sound==1){h.sound=0;b.bgm.pause();b.sound.setFrames(0,0,0)}else{h.sound=1;if(b.bgm==null){b.bgm=t.add.audio("bgm-theme"+Math.ceil(stageNo/2));b.bgm.loopFull();b.bgm.play()}else{b.bgm.resume()}b.sound.setFrames(1,1,1)}saveGameData(h)},this,h.sound,h.sound,h.sound);b.pause=t.add.button(20,10,"play-pause",function(v,w){if(h.sound==1){b.seClick.play()}t.paused=true;b.disableBg=t.add.tileSprite(t.camera.x,0,640,832,"disable-bg");b.disableBg.inputEnabled=true;b.disableBg.events.onInputDown.add(function(x,y){},this);b.dialogHalf=t.add.image(t.camera.x+20,240,"dialog-half");b.pauseStageMessage=t.add.text(t.camera.x+320,b.dialogHalf.y+60,"ステージ"+stageNo+"-"+b.stageSubNo,{font:"bold 38px Arial",fill:"#000000"});b.pauseStageMessage.anchor.set(0.5);b.pauseMessage=t.add.text(t.camera.x+320,b.dialogHalf.y+120,"ステージ選択へ戻りますか？",{font:"bold 32px Arial",fill:"#000000"});b.pauseMessage.anchor.set(0.5);b.pauseBtnClose=t.add.button(t.camera.x+550,b.dialogHalf.y-25,"btn-close",function(x,y){});b.pauseBtnRedo=t.add.button(t.camera.x+60,b.dialogHalf.y+160,"play-btn-redo",function(x,y){});b.pauseBtnBack=t.add.button(t.camera.x+340,b.dialogHalf.y+160,"play-btn-back",function(x,y){});b.pauseDialog=t.add.group();b.pauseDialog.add(b.disableBg);b.pauseDialog.add(b.dialogHalf);b.pauseDialog.add(b.pauseStageMessage);b.pauseDialog.add(b.pauseMessage);b.pauseDialog.add(b.pauseBtnClose);b.pauseDialog.add(b.pauseBtnRedo);b.pauseDialog.add(b.pauseBtnBack)},this)}function m(){b.playIdol.body.velocity.x=0;b.playIdol.body.velocity.y=0;b.playIdol.body.gravity.y=0;b.playIdol.loadTexture("play-idol-fail");b.playIdol.animations.stop(null,true);if(h.setItem==ImasRunCommon.ItemJumpUp){b.seJumpBig.stop()}else{b.seJump.stop()}for(i=0;i<b.enemy.length;i++){if(b.enemy[i].body){b.enemy[i].body.velocity.x=0;b.enemy[i].animations.stop(null,true);t.tweens.removeFrom(b.enemy[i])}}b.idolGameOver=t.add.image(b.playIdol.x+b.playIdol.width,b.playIdol.y-(b.playIdol.height/2),"play-idol-fukidashi");b.idolGameOver.alpha=0;t.add.tween(b.idolGameOver).to({alpha:1},1000,Phaser.Easing.Linear.None,true);var v=t.add.tween(b.idolGameOver).to({y:b.playIdol.y-(b.playIdol.height/2)-30},1000,Phaser.Easing.Back.Out,true);if(h.sound==1){v.onComplete.add(function(){if(b.bgm!=null){b.bgm.destroy()}b.seGameOver.play()},this)}b.disableBg=t.add.tileSprite(t.camera.x,0,650,832,"disable-bg");b.disableBg.inputEnabled=true;b.disableBg.events.onInputDown.add(function(w,x){},this);b.disableBg.alpha=0;t.add.tween(b.disableBg).to({alpha:1},1,Phaser.Easing.Linear.None,true,1000);b.gameOver=t.add.image(0,300,"play-game-over");b.gameOver.anchor.set(0.5);b.gameOver.x=t.camera.x+320;b.gameOver.alpha=0;t.add.tween(b.gameOver).to({alpha:1},1000,Phaser.Easing.Linear.None,true,1000);b.back=t.add.button(0,400,"play-btn-back",function(w,x){if(h.sound==1){b.seClick.play()}if(b.bgm!=null){b.bgm.destroy()}t.state.start("stage")});b.back.x=t.camera.x+80;b.back.inputEnabled=true;b.back.alpha=0;t.add.tween(b.back).to({alpha:1},1000,Phaser.Easing.Linear.None,true,1000);b.retry=t.add.button(0,400,"play-btn-retry",function(w,x){if(h.sound==1){b.seClick.play()}if(b.bgm!=null){b.bgm.destroy()}t.state.restart("play")});b.retry.x=t.camera.x+340;b.retry.inputEnabled=true;b.retry.alpha=0;t.add.tween(b.retry).to({alpha:1},1000,Phaser.Easing.Linear.None,true,1000);b.playStatus=d}function r(){b.playIdol.body.velocity.x=0;b.playIdol.body.velocity.y=0;b.playIdol.body.gravity.y=0;b.playIdol.animations.stop(null,true);for(i=0;i<b.enemy.length;i++){if(b.enemy[i].body){b.enemy[i].body.velocity.x=0;b.enemy[i].animations.stop(null,true);t.tweens.removeFrom(b.enemy[i])}}if(b.fog){t.add.tween(b.fog).to({alpha:0},1000,Phaser.Easing.Linear.None,true,0)}var v=b.stageSubNo;var w=1000;var x=null;if(b.starStatus==0){b.idol48=t.add.image(t.camera.x+-500,440,"idol48");t.add.tween(b.idol48).to({x:t.camera.x-40},1000,Phaser.Easing.Cubic.Out,true,w);b.idolTextFrame1=t.add.image(t.camera.x+20,300,"play-fukidashi1");b.idolText1=t.add.text(t.camera.x+50,330,"・・・",{font:"bold 32px Arial",fill:"#000"});b.fukidashi1=t.add.group();b.fukidashi1.add(b.idolTextFrame1);b.fukidashi1.add(b.idolText1);b.fukidashi1.alpha=0;t.add.tween(b.fukidashi1).to({alpha:1},1000,Phaser.Easing.Linear.None,true,w+1000);t.add.tween(b.fukidashi1).to({y:-60},1000,Phaser.Easing.Back.Out,true,w+1000);b.disableBg=t.add.tileSprite(t.camera.x,0,640,832,"disable-bg");b.disableBg.inputEnabled=true;b.disableBg.events.onInputDown.add(function(y,z){},this);b.disableBg.alpha=0;x=t.add.tween(b.disableBg).to({alpha:1},1,Phaser.Easing.Linear.None,true,w+3000);b.stageClear=t.add.text(t.camera.x+320,-200,ImasRunCommon.StageIdolList[stageNo][v][1]+"と会えなかった",{font:"42px Arial",fill:"#fff",stroke:"#000",strokeThickness:10});b.stageClear.anchor.set(0.5);t.add.tween(b.stageClear).to({y:130},1000,Phaser.Easing.Back.Out,true,w+3000);b.stageClear=t.add.text(t.camera.x+320,-200,"ステージ内に存在する★を取ろう！",{font:"28px Arial",fill:"#fff",stroke:"#000",strokeThickness:10});b.stageClear.anchor.set(0.5);t.add.tween(b.stageClear).to({y:190},1000,Phaser.Easing.Back.Out,true,w+3000);b.next=t.add.button(0,1000,"play-btn-back",function(y,z){if(h.sound==1){b.seClick.play()}if(b.bgm!=null){b.bgm.destroy()}t.state.start("stage")});b.next.x=t.camera.x+80;b.next.inputEnabled=true;t.add.tween(b.next).to({y:700},1000,Phaser.Easing.Back.Out,true,w+3000);b.retry=t.add.button(0,1000,"play-btn-retry",function(y,z){if(h.sound==1){b.seClick.play()}if(b.bgm!=null){b.bgm.destroy()}t.state.restart("play")});b.retry.x=t.camera.x+340;b.retry.inputEnabled=true;t.add.tween(b.retry).to({y:700},1000,Phaser.Easing.Back.Out,true,w+3000);if(h.sound==1){x.onComplete.add(function(){if(b.bgm!=null){b.bgm.destroy()}b.seGameClear.play()},this)}}else{if(5<b.stageSubNo){v=Math.floor(Math.random()*5)+1}b.idol48=t.add.image(t.camera.x+-500,440,"idol48");t.add.tween(b.idol48).to({x:t.camera.x-40},1000,Phaser.Easing.Cubic.Out,true,w);b.idol=t.add.image(t.camera.x+640,440,"idol"+ImasRunCommon.StageIdolList[stageNo][v][0]);t.add.tween(b.idol).to({x:t.camera.x+260},1000,Phaser.Easing.Cubic.Out,true,w+1000);b.idolTextFrame1=t.add.image(t.camera.x+20,300,"play-fukidashi1");b.idolText1=t.add.text(t.camera.x+50,330,ImasRunCommon.IdolTextList[Math.floor(Math.random()*ImasRunCommon.IdolTextList.length)],{font:"bold 32px Arial",fill:"#000"});b.fukidashi1=t.add.group();b.fukidashi1.add(b.idolTextFrame1);b.fukidashi1.add(b.idolText1);b.fukidashi1.alpha=0;t.add.tween(b.fukidashi1).to({alpha:1},1000,Phaser.Easing.Linear.None,true,w+2000);t.add.tween(b.fukidashi1).to({y:-60},1000,Phaser.Easing.Back.Out,true,w+2000);b.idolTextFrame2=t.add.image(t.camera.x+90,410,"play-fukidashi2");b.idolText2=t.add.text(t.camera.x+120,440,ImasRunCommon.StageIdolList[stageNo][v][2],{font:"bold 32px Arial",fill:"#000"});b.fukidashi2=t.add.group();b.fukidashi2.add(b.idolTextFrame2);b.fukidashi2.add(b.idolText2);b.fukidashi2.alpha=0;t.add.tween(b.fukidashi2).to({alpha:1},1000,Phaser.Easing.Linear.None,true,w+3500);t.add.tween(b.fukidashi2).to({y:-60},1000,Phaser.Easing.Back.Out,true,w+3500);b.disableBg=t.add.tileSprite(t.camera.x,0,640,832,"disable-bg");b.disableBg.inputEnabled=true;b.disableBg.events.onInputDown.add(function(y,z){},this);b.disableBg.alpha=0;x=t.add.tween(b.disableBg).to({alpha:1},1,Phaser.Easing.Linear.None,true,w+5500);b.stageClear=t.add.text(t.camera.x+320,-200,ImasRunCommon.StageIdolList[stageNo][v][1]+"と会った！",{font:"48px Arial",fill:"#fff",stroke:"#000",strokeThickness:10});b.stageClear.anchor.set(0.5);t.add.tween(b.stageClear).to({y:130},1000,Phaser.Easing.Back.Out,true,w+5500);if(5<b.stageSubNo){b.retry=t.add.button(0,1000,"play-btn-retry",function(y,z){if(h.sound==1){b.seClick.play()}if(b.bgm!=null){b.bgm.destroy()}t.state.restart("play")});b.retry.x=t.camera.x+80;b.retry.inputEnabled=true;t.add.tween(b.retry).to({y:700},1000,Phaser.Easing.Back.Out,true,w+5500)}b.next=t.add.button(0,1000,"play-btn-next",function(y,z){if(h.sound==1){b.seClick.play()}if(b.bgm!=null){b.bgm.destroy()}t.state.start("stage")});if(5<b.stageSubNo){b.next.x=t.camera.x+340}else{b.next.x=t.camera.x+200}b.next.inputEnabled=true;t.add.tween(b.next).to({y:700},1000,Phaser.Easing.Back.Out,true,w+5500);if(b.stageSubNo==5){if(h.clear<stageNo){h.clear=stageNo}}if(h.sound==1){x.onComplete.add(function(){if(b.bgm!=null){b.bgm.destroy()}b.seGameClearStar.play()},this)}}h.coin+=b.coin;if(ImasRunCommon.MaxCoin<h.coin){h.coin=ImasRunCommon.MaxCoin}if(b.stageSubNo<=5){h.stage[stageNo][b.stageSubNo]=b.starStatus}saveGameData(h);b.playStatus=u}};