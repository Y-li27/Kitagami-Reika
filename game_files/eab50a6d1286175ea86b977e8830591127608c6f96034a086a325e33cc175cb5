function addShop(b,a){var c={};b.state.add("shop",{preload:function(){},create:function(){c.seClick=b.add.audio("se-click");c.seBuy=b.add.audio("se-buy");c.shopBg=b.add.tileSprite(0,0,640,832,"shop-bg");c.back=b.add.button(20,10,"back",function(i,j){if(a.sound==1){c.seClick.play()}b.state.start("stage")});c.shopTitle=b.add.image(320,50,"shop-title");c.shopTitle.anchor.set(0.5);c.sound=b.add.button(530,10,"sound",function(i,j){if(a.sound==1){a.sound=0;bgmMenu.pause();c.sound.setFrames(0,0,0)}else{a.sound=1;if(bgmMenu==null){bgmMenu=b.add.audio("bgm-menu");bgmMenu.loopFull();bgmMenu.play()}else{bgmMenu.resume()}c.sound.setFrames(1,1,1)}saveGameData(a)},this,a.sound,a.sound,a.sound);c.coinBg=b.add.image(320,136,"coin-bg");c.coinBg.anchor.set(0.5);c.coin=parseInt(a.coin);c.coinText=b.add.text(200,114,c.coin+"枚",{font:"bold 42px Arial",fill:"#000"});var e=0;for(var g=1;g<=10;g++){for(var f=1;f<=5;f++){if(a.stage[g][f]==1){e++}}}c.stageBtn=[];var h,d,l=0;for(h in ImasRunCommon.ItemList){d=20+(((h-1)%3)*200);l=190+Math.floor((h-1)/3)*210;if(h==ImasRunCommon.ItemFly&&e<50){continue}c.stageBtn[h]=b.add.button(d,l,"shop-item"+h,function(i,j){if(a.sound==1){c.seClick.play()}c.itemNo=i.key.replace("shop-item","");c.disableBg=b.add.tileSprite(0,0,640,832,"disable-bg");c.disableBg.inputEnabled=true;c.disableBg.events.onInputDown.add(function(k,m){},this);c.dialog=b.add.image(20,220,"dialog-middle");c.name=b.add.text(320,290,ImasRunCommon.ItemList[c.itemNo].name,{font:"bold 48px Arial",fill:"#000"});c.name.anchor.set(0.5);c.text=b.add.text(320,360,ImasRunCommon.ItemList[c.itemNo].text,{font:"32px Arial",fill:"#000000"});c.text.anchor.set(0.5);if(a["item"+c.itemNo]==0){if(c.itemNo==ImasRunCommon.ItemFly&&c.itemNew){c.itemNew.destroy();a.item7View=1;saveGameData(a)}c.dialogCoin=b.add.text(320,430,ImasRunCommon.ItemList[c.itemNo].coin+"枚必要",{font:"28px Arial",fill:"#fff",stroke:"#000",strokeThickness:8});c.dialogCoin.anchor.set(0.5);c.dialogCoinMessage=b.add.text(320,470,"コインが不足しています",{font:"bold 24px Arial",fill:"#FF0000"});c.dialogCoinMessage.anchor.set(0.5);if(ImasRunCommon.ItemList[c.itemNo].coin<=c.coin){c.dialogCoinMessage.visible=false;c.btnBuy=b.add.button(200,500,"shop-btn-buy",function(k,m){if(a.sound==1){c.seBuy.play()}a.coin=c.coin-ImasRunCommon.ItemList[c.itemNo].coin;a["item"+c.itemNo]=1;saveGameData(a);b.state.restart("shop")},this,1,1,1)}else{c.btnBuy=b.add.image(200,500,"shop-btn-buy",0)}c.btnClose=b.add.button(550,c.dialog.y-25,"btn-close",function(k,m){if(a.sound==1){c.seClick.play()}c.disableBg.destroy();c.dialog.destroy();c.name.destroy();c.text.destroy();c.dialogCoin.destroy();c.dialogCoinMessage.destroy();c.btnClose.destroy();c.btnBuy.destroy()},this)}else{c.dialogCoin=b.add.text(320,470,"購入済み",{font:"28px Arial",fill:"#fff",stroke:"#000",strokeThickness:8});c.dialogCoin.anchor.set(0.5);c.btnClose=b.add.button(550,c.dialog.y-25,"btn-close",function(k,m){if(a.sound==1){c.seClick.play()}c.disableBg.destroy();c.dialog.destroy();c.name.destroy();c.text.destroy();c.dialogCoin.destroy();c.btnClose.destroy()},this)}},this);c.itemNew=null;if(h==ImasRunCommon.ItemFly&&a.item7View==0){c.itemNew=b.add.image(d+170,l+5,"new-icon");c.itemNew.anchor.set(0.5);b.add.tween(c.itemNew.scale).to({x:1.2,y:1.2},1000,Phaser.Easing.Linear.None,true,0,-1,true)}if(a["item"+h]==0){c.coinText=b.add.text(0,l+180,ImasRunCommon.ItemList[h].coin+"枚必要",{font:"28px Arial",fill:"#fff",stroke:"#000",strokeThickness:8})}else{c.coinText=b.add.text(0,l+180,"購入済み",{font:"28px Arial",fill:"#fff",stroke:"#000",strokeThickness:8})}c.coinText.anchor.set(0.5);c.coinText.x=d+100}},update:function(){}})};